<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Catalogue · William Shakes Pear</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://use.typekit.net/nmx3jjw.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="pagetransition.css">

  <style>

:root{
  --primary: #fff7e0;
}
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "phoreuscherokee", serif;
      font-weight: 400;
      background: #f7f5f0;
      color: #1f1f1f;
      line-height: 1.5;
      padding: 1.5rem;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    header {
      max-width: 960px;
      margin: 0 auto 2rem;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;

      position: relative;
      z-index: 2;
      /* below spotlight */
    }

    .back-link {
      font-size: 0.85rem;
      opacity: 0.75;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .back-link:hover {
      opacity: 1;
    }

    h1 {
      font-size: clamp(2rem, 4vw, 2.6rem);
    }

    .subtitle {
      font-size: 0.95rem;
      opacity: 0.85;
      max-width: 520px;
    }

    /* ===== SPOTLIGHT EFFECT ===== */
    :root {
      --spot-x: 100%;
      --spot-y: 0%;
    }

    .spotlight-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 3;

      opacity: 0;
      transition: opacity 0.4s ease;

      background:
        radial-gradient(circle at var(--spot-x) var(--spot-y),
          rgba(255, 255, 255, 0.95) 0,
          rgba(255, 255, 255, 0.85) 70px,
          rgba(72, 58, 36, 0.7) 150px,
          rgba(72, 56, 38, 0.8) 100%);
      mix-blend-mode: multiply;
    }

    .spotlight-overlay.is-active {
      opacity: 1;
    }


    /* ===== FILTER BAR ===== */
    .filter-bar {
      margin-top: 4rem;
      display: flex;
      justify-content: center;
    }

    .filter-help {
  margin-top: 2rem;
  text-align: center;
  font-size: 0.8rem;
  color: #5c5147;

  position: relative;
  min-height: 1.4em; 
}

.filter-help-main,
.filter-help-tip {
  position: absolute;
  left: 50%;
  top: 0;
  transform: translateX(-50%);
  white-space: nowrap; 
  transition:
    opacity 0.2s ease-out,
    transform 0.2s ease-out;
}

.filter-help-main {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

.filter-help-tip {
  opacity: 0;
  transform: translateX(-50%) translateY(3px);
  z-index: 1000;
}

body.has-active-filter .filter-help-main {
  opacity: 0;
  transform: translateX(-50%) translateY(-3px);
  pointer-events: none;
}

body.has-active-filter .filter-help-tip {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}


    .filter-pills-row {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      flex-wrap: wrap;
    }

    /* button shell */
    .filter-pill {
      border: none;
      background: transparent;
      padding: 0;
      cursor: pointer;

      display: inline-flex;
      align-items: center;
      justify-content: center;

      transition:
        transform 0.12s ease,
        filter 0.12s ease;
    }

    /* stack icon + label */
    .filter-pill-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
    }

    .filter-pill-icon {
      max-width: 150px;
      height: auto;
      display: block;
      pointer-events: none;
    }

    /* the label: hidden until hover */
    .filter-pill-label {
      font-family: "phoreuscherokee", serif;
      font-size: 1rem;
      opacity: 0.35;
      /* default: low opacity */
      transform: translateY(2px) scale(0.96);
      transform-origin: top center;
      pointer-events: none;
      transition:
        opacity 0.18s ease-out,
        transform 0.18s ease-out;
    }


    /* hover: lift icon a bit */
    .filter-pill:hover {
      filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.18));
    }

    .filter-pill:hover .filter-pill-label {
      opacity: 1;
    }

    .filter-pill.is-active .filter-pill-label {
      opacity: 1;
    }

    .filter-pill.is-active .filter-pill-icon {
      animation: pearShake 0.4s ease-in-out;
    }


    .filter-pill.is-active {
      filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.25));
    }

    @keyframes pearShake {
      0% {
        transform: translateX(0) rotate(0deg);
      }

      20% {
        transform: translateX(-2px) rotate(-2deg);
      }

      40% {
        transform: translateX(2px) rotate(2deg);
      }

      60% {
        transform: translateX(-1px) rotate(-1deg);
      }

      80% {
        transform: translateX(1px) rotate(1deg);
      }

      100% {
        transform: translateX(0) rotate(0deg);
      }
    }



    /* ===== LIST ===== */

    main {
      max-width: 960px;
      margin: 0 auto;

      position: relative;
      z-index: 4;
    }

    .list {
      margin-top: 2.5rem;
      border-radius: 16px;
      overflow: hidden;
      background: rgba(255, 253, 248, 0.9);
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
      display: none;
      font-size: 0.8rem;
    }

    .list.is-visible {
      display: block;
    }

    .list-header {
      display: grid;
      grid-template-columns: 2.5fr 1.25fr 1.55fr;
      gap: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 0.75rem 1.25rem;
      background: #efe4d5;
      color: #4a3c2f;
    }

    .list-header span {
      opacity: 0.9;
      text-align: left;
    }

    .work-summary-inner>div {
      font-size: 0.8rem;

      text-align: left;
    }

    .work {
      border-top: 1px solid rgba(0, 0, 0, 0.06);
      background: rgba(255, 253, 248, 0.97);
    }

    .work[open] {
      background: #efe4d5;
    }

    .work-summary {
      list-style: none;
      cursor: pointer;
      padding: 0;
    }

    .work-summary::-webkit-details-marker {
      display: none;
    }

    .work-summary-inner {
      display: grid;
      grid-template-columns: 2.5fr 1.2fr 1.6fr;
      gap: 0.75rem;
      align-items: center;
      padding: 0.9rem 1.25rem;
      font-size: 1rem;
    }

    .work-title {
      font-weight: 400;
    }

    .work-genre {
      opacity: 0.85;
    }

    .work-length {
      display: flex;
      align-items: center;
    }

    .work-length span {
      display: inline-block;
      padding: 0.1rem 0.5rem;
    }

    .work-chevron {
      opacity: 0.6;
      margin-left: 0.5rem;
    }

    .work-panel {
      padding: 0 1.25rem 1rem;
      font-size: 0.75rem;
      color: #40362d;
    }

    .work:hover{
      background: #efe4d5;
    }


    p {
      font-size: 0.75rem;
      line-height: 2rem;
      margin-bottom: 1.5rem;
    }
    
    .work-panel-synopsis {
      margin-bottom: 0.75rem;
      font-size: 0.75rem;
    }

    .work-panel-synopsis h1,
    .work-panel-synopsis h2,
    .work-panel-synopsis h3 {
      font-family: "phoreuscherokee", serif;
      font-size: 0.9rem;
      font-weight: 600;
      font-style: normal;
      margin: 0 0 0.5rem;
    }

    .work-panel-synopsis h1 em,
    .work-panel-synopsis h1 i,
    .work-panel-synopsis h2 em,
    .work-panel-synopsis h2 i,
    .work-panel-synopsis h3 em,
    .work-panel-synopsis h3 i {
      font-style: normal;
    }

    .empty-state {
      padding: 2rem 1.25rem;
      font-size: 0.9rem;
      opacity: 0.75;
      text-align: center;
    }

    @media (max-width: 700px) {
      .list-header {
        display: none;
      }

      .work-summary-inner {
        grid-template-rows: 1fr;
        gap: 0.25rem;
      }

      .work-genre,
      .work-length {
        font-size: 0.8rem;
      }
    }
  </style>
</head>


<body>
  <header>
    <a href="index.html" class="back-link">← Back to home</a>
    <h1>Catalogue of Plays</h1>
    <p class="subtitle">
      Every entry here is a Shakespeare play supported by the Folger Digital
      Texts API. Click a row to load its synopsis directly from the API.
    </p>

    <div class="filter-bar">
      <div class="filter-pills-row">
        <button class="filter-pill" data-genre="all">
          <div class="filter-pill-inner">
            <img src="illustration/All.png" alt="Show all plays" class="filter-pill-icon" />
            <span class="filter-pill-label">All</span>
          </div>
        </button>

        <button class="filter-pill" data-genre="Comedy">
          <div class="filter-pill-inner">
            <img src="illustration/Comedy.png" alt="Show comedies" class="filter-pill-icon" />
            <span class="filter-pill-label">Comedy</span>
          </div>
        </button>

        <button class="filter-pill" data-genre="Tragedy">
          <div class="filter-pill-inner">
            <img src="illustration/Tragedy.png" alt="Show tragedies" class="filter-pill-icon" />
            <span class="filter-pill-label">Tragedy</span>
          </div>
        </button>

        <button class="filter-pill" data-genre="History">
          <div class="filter-pill-inner">
            <img src="illustration/History.png" alt="Show histories" class="filter-pill-icon" />
            <span class="filter-pill-label">History</span>
          </div>
        </button>

        <button class="filter-pill" data-genre="Romance">
          <div class="filter-pill-inner">
            <img src="illustration/Romance.png" alt="Show romances" class="filter-pill-icon" />
            <span class="filter-pill-label">Romance</span>
          </div>
        </button>
      </div>
    </div>

    <div class="filter-help">
      <div class="filter-help-main">
        Select your pear to begin exploring the plays.
      </div>
      <div class="filter-help-tip">
        Click anywhere outside the list to remove the filter.
      </div>
    </div>


  </header>

  <main>
    <div class="list" id="works-list">
      <div class="list-header">
        <span>Title</span>
        <span>Genre</span>
        <span>Length</span>
      </div>
      <div class="empty-state" id="empty-state" style="display:none;">
        No plays match this filter yet.
      </div>
    </div>
  </main>

  <div class="spotlight-overlay"></div>

  <div class="page-transition" id="pageTransition">
    <img
      src="illustration/pearicon.png"
      alt="Rolling pear transition"
      class="page-transition-pear"
    />
  </div>
</body>
<script>
  async function fetchViaProxy(url) {
    const proxyUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(url);
    const res = await fetch(proxyUrl);
    if (!res.ok) {
      throw new Error("Proxy HTTP " + res.status);
    }
    return res.text();
  }

  const WORKS = [
    { id: "AWW", playCode: "AWW", title: "All's Well That Ends Well", genre: "Comedy", length: "Medium" },
    { id: "Ant", playCode: "Ant", title: "Antony and Cleopatra", genre: "Tragedy", length: "Long" },
    { id: "AYL", playCode: "AYL", title: "As You Like It", genre: "Comedy", length: "Medium" },
    { id: "Err", playCode: "Err", title: "The Comedy of Errors", genre: "Comedy", length: "Short" },
    { id: "Cor", playCode: "Cor", title: "Coriolanus", genre: "Tragedy", length: "Long" },
    { id: "Cym", playCode: "Cym", title: "Cymbeline", genre: "Romance", length: "Long" },
    { id: "Ham", playCode: "Ham", title: "Hamlet", genre: "Tragedy", length: "Long" },
    { id: "1H4", playCode: "1H4", title: "Henry IV, Part 1", genre: "History", length: "Medium" },
    { id: "2H4", playCode: "2H4", title: "Henry IV, Part 2", genre: "History", length: "Medium" },
    { id: "H5", playCode: "H5", title: "Henry V", genre: "History", length: "Medium" },
    { id: "1H6", playCode: "1H6", title: "Henry VI, Part 1", genre: "History", length: "Medium" },
    { id: "2H6", playCode: "2H6", title: "Henry VI, Part 2", genre: "History", length: "Medium" },
    { id: "3H6", playCode: "3H6", title: "Henry VI, Part 3", genre: "History", length: "Medium" },
    { id: "H8", playCode: "H8", title: "Henry VIII", genre: "History", length: "Medium" },
    { id: "JC", playCode: "JC", title: "Julius Caesar", genre: "Tragedy", length: "Medium" },
    { id: "Jn", playCode: "Jn", title: "King John", genre: "History", length: "Medium" },
    { id: "Lr", playCode: "Lr", title: "King Lear", genre: "Tragedy", length: "Long" },
    { id: "LLL", playCode: "LLL", title: "Love's Labor's Lost", genre: "Comedy", length: "Medium" },
    { id: "Mac", playCode: "Mac", title: "Macbeth", genre: "Tragedy", length: "Medium" },
    { id: "MM", playCode: "MM", title: "Measure for Measure", genre: "Comedy", length: "Medium" },
    { id: "MV", playCode: "MV", title: "The Merchant of Venice", genre: "Comedy", length: "Medium" },
    { id: "Wiv", playCode: "Wiv", title: "The Merry Wives of Windsor", genre: "Comedy", length: "Medium" },
    { id: "MND", playCode: "MND", title: "A Midsummer Night's Dream", genre: "Comedy", length: "Medium" },
    { id: "Ado", playCode: "Ado", title: "Much Ado About Nothing", genre: "Comedy", length: "Medium" },
    { id: "Oth", playCode: "Oth", title: "Othello", genre: "Tragedy", length: "Medium" },
    { id: "Per", playCode: "Per", title: "Pericles", genre: "Romance", length: "Medium" },
    { id: "R2", playCode: "R2", title: "Richard II", genre: "History", length: "Medium" },
    { id: "R3", playCode: "R3", title: "Richard III", genre: "History", length: "Long" },
    { id: "Rom", playCode: "Rom", title: "Romeo and Juliet", genre: "Tragedy", length: "Medium" },
    { id: "Shr", playCode: "Shr", title: "The Taming of the Shrew", genre: "Comedy", length: "Medium" },
    { id: "Tmp", playCode: "Tmp", title: "The Tempest", genre: "Romance", length: "Medium" },
    { id: "Tim", playCode: "Tim", title: "Timon of Athens", genre: "Tragedy", length: "Medium" },
    { id: "Tit", playCode: "Tit", title: "Titus Andronicus", genre: "Tragedy", length: "Medium" },
    { id: "Tro", playCode: "Tro", title: "Troilus and Cressida", genre: "Tragedy", length: "Long" },
    { id: "TN", playCode: "TN", title: "Twelfth Night", genre: "Comedy", length: "Medium" },
    { id: "TGV", playCode: "TGV", title: "Two Gentlemen of Verona", genre: "Comedy", length: "Short" },
    { id: "TNK", playCode: "TNK", title: "Two Noble Kinsmen", genre: "Romance", length: "Medium" },
    { id: "WT", playCode: "WT", title: "The Winter's Tale", genre: "Romance", length: "Long" },
  ];

  const worksList = document.getElementById("works-list");
  const emptyState = document.getElementById("empty-state");
  const filterButtons = document.querySelectorAll(".filter-pill");
  const spotlightOverlay = document.querySelector(".spotlight-overlay");

  let activeGenreFilter = "all";

  // Cache for synopses so each play only fetches once
  const SYNOPSIS_CACHE = {}; // { playCode: htmlString }

  function setSpotlightPosition(button) {
    if (!spotlightOverlay || !button) return;

    const icon = button.querySelector(".filter-pill-icon") || button;
    const rect = icon.getBoundingClientRect();

    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;

    const vw = window.innerWidth;
    const vh = window.innerHeight;

    const xPercent = (cx / vw) * 100;
    const yPercent = (cy / vh) * 100;

    document.documentElement.style.setProperty("--spot-x", `${xPercent}%`);
    document.documentElement.style.setProperty("--spot-y", `${yPercent}%`);
  }

  function triggerSpotlight(button) {
    setSpotlightPosition(button);
    if (spotlightOverlay) {
      spotlightOverlay.classList.add("is-active");
    }
  }

  function buildInitialList() {
    WORKS.forEach((work) => {
      const details = document.createElement("details");
      details.className = "work";
      details.dataset.playCode = work.playCode;
      details.dataset.genre = work.genre;

      const summary = document.createElement("summary");
      summary.className = "work-summary";

      const summaryInner = document.createElement("div");
      summaryInner.className = "work-summary-inner";

      const titleCol = document.createElement("div");
      titleCol.className = "work-title";
      titleCol.textContent = work.title;

      const chevron = document.createElement("span");
      chevron.className = "work-chevron";
      chevron.textContent = "▾";
      titleCol.appendChild(chevron);

      const genreCol = document.createElement("div");
      genreCol.className = "work-genre";
      genreCol.textContent = work.genre;

      const lengthCol = document.createElement("div");
      lengthCol.className = "work-length";
      const lengthSpan = document.createElement("span");
      lengthSpan.textContent = work.length;
      lengthCol.appendChild(lengthSpan);

      summaryInner.appendChild(titleCol);
      summaryInner.appendChild(genreCol);
      summaryInner.appendChild(lengthCol);

      summary.appendChild(summaryInner);
      details.appendChild(summary);

      const panel = document.createElement("div");
      panel.className = "work-panel";

      const synopsisContainer = document.createElement("div");
      synopsisContainer.className = "work-panel-synopsis";
      synopsisContainer.textContent = "Click to load synopsis from the Folger API…";

      panel.appendChild(synopsisContainer);
      details.appendChild(panel);

      // When a play is opened, load or reuse cached synopsis
      details.addEventListener("toggle", async () => {
        if (!details.open) return;

        // Close all other open details so we don't spam requests
        document.querySelectorAll(".work[open]").forEach((d) => {
          if (d !== details) d.open = false;
        });

        const playCode = work.playCode;
        const synopsisUrl = `https://www.folgerdigitaltexts.org/${playCode}/synopsis/`;

        if (SYNOPSIS_CACHE[playCode]) {
          synopsisContainer.innerHTML = SYNOPSIS_CACHE[playCode];
          return;
        }

        synopsisContainer.textContent = "Loading synopsis from Folger…";

        try {
          const synopsisHtml = await fetchViaProxy(synopsisUrl);

          const tmp = document.createElement("div");
          tmp.innerHTML = synopsisHtml;

          const headingToRemove = Array.from(
            tmp.querySelectorAll("h1, h2, h3")
          ).find((h) => /synopsis\s+of/i.test(h.textContent));
          if (headingToRemove) headingToRemove.remove();

          // Trim everything after first <hr> (no act-by-act breakdown)
          const firstHr = tmp.querySelector("hr");
          if (firstHr) {
            let node = firstHr;
            while (node) {
              const next = node.nextSibling;
              node.remove();
              node = next;
            }
          }

          const cleanHtml = tmp.innerHTML;
          SYNOPSIS_CACHE[playCode] = cleanHtml;
          synopsisContainer.innerHTML = cleanHtml;
        } catch (err) {
          console.error(err);
          synopsisContainer.innerHTML =
            `Unable to load synopsis automatically. ` +
            `<a href="${synopsisUrl}" target="_blank" rel="noopener noreferrer">` +
            `View synopsis on Folger’s site ↗</a>`;
        }
      });

      worksList.appendChild(details);
    });
  }

  function applyFilter() {
    const allDetails = worksList.querySelectorAll(".work");
    let anyVisible = false;

    allDetails.forEach((details) => {
      const genre = details.dataset.genre;
      const matches =
        activeGenreFilter === "all" || genre === activeGenreFilter;

      details.style.display = matches ? "" : "none";
      if (matches) anyVisible = true;
    });

    emptyState.style.display = anyVisible ? "none" : "block";
  }

  // Filter pill click behavior
  filterButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      filterButtons.forEach((b) => b.classList.remove("is-active"));
      btn.classList.add("is-active");

      triggerSpotlight(btn);

      activeGenreFilter = btn.getAttribute("data-genre") || "all";

      worksList.classList.add("is-visible");
      document.body.classList.add("has-active-filter");

      applyFilter();
    });
  });

  // Clicking outside filters + list clears filters and hides list
  document.addEventListener("click", (event) => {
    const clickedInsideFilters = event.target.closest(".filter-bar");
    const clickedInsideList = event.target.closest("#works-list");

    if (clickedInsideFilters || clickedInsideList) {
      return;
    }

    filterButtons.forEach((b) => b.classList.remove("is-active"));

    if (spotlightOverlay) {
      spotlightOverlay.classList.remove("is-active");
    }

    worksList.classList.remove("is-visible");
    activeGenreFilter = "all";
    document.body.classList.remove("has-active-filter");
  });

  // Keep spotlight following the active filter on scroll
  window.addEventListener("scroll", () => {
    const activeBtn = document.querySelector(".filter-pill.is-active");
    if (!activeBtn) return;
    if (!spotlightOverlay || !spotlightOverlay.classList.contains("is-active"))
      return;

    setSpotlightPosition(activeBtn);
  });

  // Rolling pear transition back to home
  const pageTransition = document.getElementById("pageTransition");
  const backLink = document.querySelector(".back-link");

  if (pageTransition && backLink) {
    backLink.addEventListener("click", (event) => {
      event.preventDefault();
      const href = backLink.getAttribute("href");
      if (!href) return;

      pageTransition.classList.add("is-active");

      setTimeout(() => {
        window.location.href = href;
      }, 900);
    });
  }

  buildInitialList();
</script>


</html>